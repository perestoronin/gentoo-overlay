From d920f5a90287fa91c6f04ee5bdbb851980ba3f16 Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Fri, 23 Dec 2022 14:41:20 +0100
Subject: [PATCH] system glslang

---
 cmake/SearchForStuff.cmake       | 5 -----
 common/CMakeLists.txt            | 4 ++--
 common/Vulkan/ShaderCompiler.cpp | 6 +++---
 3 files changed, 5 insertions(+), 10 deletions(-)

diff --git a/cmake/SearchForStuff.cmake b/cmake/SearchForStuff.cmake
index b8424334b..cd227a885 100644
--- a/cmake/SearchForStuff.cmake
+++ b/cmake/SearchForStuff.cmake
@@ -290,11 +290,6 @@ if(USE_OPENGL)
 	add_subdirectory(3rdparty/glad EXCLUDE_FROM_ALL)
 endif()
 
-if(USE_VULKAN)
-	add_subdirectory(3rdparty/glslang EXCLUDE_FROM_ALL)
-	add_subdirectory(3rdparty/vulkan-headers EXCLUDE_FROM_ALL)
-endif()
-
 if(CUBEB_API)
 	add_subdirectory(3rdparty/cubeb EXCLUDE_FROM_ALL)
 	target_compile_options(cubeb PRIVATE "-w")
diff --git a/common/CMakeLists.txt b/common/CMakeLists.txt
index 31f350f63..43c1abd53 100644
--- a/common/CMakeLists.txt
+++ b/common/CMakeLists.txt
@@ -146,8 +146,8 @@ if(USE_OPENGL)
 endif()
 
 if(USE_VULKAN)
-	target_link_libraries(common PUBLIC
-		Vulkan-Headers glslang
+    target_link_libraries(common PUBLIC
+        glslang glslang-default-resource-limits SPIRV
 	)
 	target_sources(common PRIVATE
 		Vulkan/ShaderCache.cpp
diff --git a/common/Vulkan/ShaderCompiler.cpp b/common/Vulkan/ShaderCompiler.cpp
index 0dde37985..71a3cc4b5 100644
--- a/common/Vulkan/ShaderCompiler.cpp
+++ b/common/Vulkan/ShaderCompiler.cpp
@@ -23,8 +23,8 @@
 #include <memory>
 
 // glslang includes
-#include "SPIRV/GlslangToSpv.h"
-#include "StandAlone/ResourceLimits.h"
+#include "glslang/SPIRV/GlslangToSpv.h"
+#include "glslang/Public/ResourceLimits.h"
 #include "glslang/Public/ShaderLang.h"
 
 namespace Vulkan::ShaderCompiler
@@ -80,7 +80,7 @@ namespace Vulkan::ShaderCompiler
 		};
 
 		if (!shader->parse(
-				&glslang::DefaultTBuiltInResource, default_version, profile, false, true, messages, includer))
+         GetDefaultResources(), default_version, profile, false, true, messages, includer))
 		{
 			DumpBadShader("Failed to parse shader");
 			return std::nullopt;
-- 
2.39.0

