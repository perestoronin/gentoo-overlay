From 245014d8a4c8d9a1bee97fe766cc857efb569985 Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Mon, 26 Sep 2022 13:49:16 +0200
Subject: [PATCH] Use from_chars from c++ libs

---
 cmake/SearchForStuff.cmake | 8 --------
 common/CMakeLists.txt      | 1 -
 common/StringUtil.h        | 3 +--
 3 files changed, 1 insertion(+), 11 deletions(-)

diff --git a/cmake/SearchForStuff.cmake b/cmake/SearchForStuff.cmake
index b061982e6..109d8ee95 100644
--- a/cmake/SearchForStuff.cmake
+++ b/cmake/SearchForStuff.cmake
@@ -252,14 +252,6 @@ else()
 	set(BIN2CPPDEP ${CMAKE_SOURCE_DIR}/linux_various/hex2h.pl)
 endif()
 
-# rapidyaml includes fast_float as a submodule, saves us pulling it in directly.
-# Normally, we'd just pull in the cmake project, and link to it, but... it seems to enable
-# permissive mode, which breaks other parts of PCSX2. So, we'll just create a target here
-# for now.
-#add_subdirectory(3rdparty/rapidyaml/rapidyaml/ext/c4core/src/c4/ext/fast_float EXCLUDE_FROM_ALL)
-add_library(fast_float INTERFACE)
-target_include_directories(fast_float INTERFACE 3rdparty/rapidyaml/rapidyaml/ext/c4core/src/c4/ext/fast_float/include)
-
 add_subdirectory(3rdparty/jpgd EXCLUDE_FROM_ALL)
 add_subdirectory(3rdparty/simpleini EXCLUDE_FROM_ALL)
 add_subdirectory(3rdparty/imgui EXCLUDE_FROM_ALL)
diff --git a/common/CMakeLists.txt b/common/CMakeLists.txt
index 51101e626..8d6e2b3c6 100644
--- a/common/CMakeLists.txt
+++ b/common/CMakeLists.txt
@@ -288,7 +288,6 @@ target_link_libraries(common PRIVATE
 
 target_link_libraries(common PUBLIC
 	fmt::fmt
-	fast_float
 )
 
 fixup_file_properties(common)
diff --git a/common/StringUtil.h b/common/StringUtil.h
index b9db36b8f..e6f82b6f3 100644
--- a/common/StringUtil.h
+++ b/common/StringUtil.h
@@ -25,7 +25,6 @@
 #include <string_view>
 #include <vector>
 
-#include "fast_float/fast_float.h"
 
 // Older versions of libstdc++ are missing support for from_chars() with floats, and was only recently
 // merged in libc++. So, just fall back to stringstream (yuck!) on everywhere except MSVC.
@@ -94,7 +93,7 @@ namespace StringUtil
 	{
 		T value;
 
-		const fast_float::from_chars_result result = fast_float::from_chars(str.data(), str.data() + str.length(), value);
+		const std::from_chars_result result = std::from_chars(str.data(), str.data() + str.length(), value);
 		if (result.ec != std::errc())
 			return std::nullopt;
 
-- 
2.37.3

