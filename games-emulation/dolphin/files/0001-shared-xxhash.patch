From 3d6123f15a090115ac45e49b760dacc63b38bf68 Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Sun, 21 Aug 2022 15:53:16 +0200
Subject: [PATCH] shared xxhash

---
 CMakeLists.txt                                  | 3 ++-
 Source/Core/VideoBackends/Vulkan/CMakeLists.txt | 2 +-
 Source/Core/VideoCommon/CMakeLists.txt          | 2 +-
 3 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 163ea2c943..eac99af420 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -744,7 +744,8 @@ else()
   add_subdirectory(Externals/enet)
 endif()
 
-if(NOT XXHASH_FOUND)
+pkg_check_modules(xxhash REQUIRED IMPORTED_TARGET libxxhash)
+if(NOT xxhash_FOUND)
   message(STATUS "Using static xxhash from Externals")
   add_subdirectory(Externals/xxhash)
 endif()
diff --git a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
index 4489ca9e10..826cd5e932 100644
--- a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
+++ b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
@@ -45,7 +45,7 @@ PUBLIC
 PRIVATE
   # Link against glslang, the other necessary libraries are referenced by the executable.
   glslang
-  xxhash
+  PkgConfig::xxhash
 )
 
 # Only include the Vulkan headers when building the Vulkan backend
diff --git a/Source/Core/VideoCommon/CMakeLists.txt b/Source/Core/VideoCommon/CMakeLists.txt
index a7e9548d91..5da849ef9e 100644
--- a/Source/Core/VideoCommon/CMakeLists.txt
+++ b/Source/Core/VideoCommon/CMakeLists.txt
@@ -165,7 +165,7 @@ PUBLIC
 PRIVATE
   fmt::fmt
   spng
-  xxhash
+  PkgConfig::xxhash
   imgui
   glslang
 )
-- 
2.37.2

