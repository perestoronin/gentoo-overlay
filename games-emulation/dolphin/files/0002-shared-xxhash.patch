From fba3ad6039e5e9d9bafaa91b0b0acadd4ae51432 Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Sat, 24 Dec 2022 09:13:05 +0100
Subject: [PATCH] shared xxhash

---
 CMakeLists.txt                                  | 3 ++-
 Source/Core/VideoBackends/Vulkan/CMakeLists.txt | 2 +-
 Source/Core/VideoCommon/CMakeLists.txt          | 2 +-
 3 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 13830bad70..2660baf593 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -745,7 +745,8 @@ else()
   add_subdirectory(Externals/enet)
 endif()
 
-if(NOT XXHASH_FOUND)
+pkg_check_modules(xxhash REQUIRED IMPORTED_TARGET libxxhash)
+if(NOT xxhash_FOUND)
   message(STATUS "Using static xxhash from Externals")
   add_subdirectory(Externals/xxhash)
 endif()
diff --git a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
index 5fd6aa1ed7..3f827829c0 100644
--- a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
+++ b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
@@ -45,7 +45,7 @@ PUBLIC
 PRIVATE
   # Link against glslang, the other necessary libraries are referenced by the executable.
   glslang
-  xxhash
+  PkgConfig::xxhash
 )
 
 # Only include the Vulkan headers when building the Vulkan backend
diff --git a/Source/Core/VideoCommon/CMakeLists.txt b/Source/Core/VideoCommon/CMakeLists.txt
index a7a52c5e40..333fad6523 100644
--- a/Source/Core/VideoCommon/CMakeLists.txt
+++ b/Source/Core/VideoCommon/CMakeLists.txt
@@ -168,7 +168,7 @@ PUBLIC
 PRIVATE
   fmt::fmt
   spng
-  xxhash
+  PkgConfig::xxhash
   imgui
   implot
   glslang
-- 
2.39.0

