From 939a90b4ad1f9e2aeb7ee81549cc89c704143b92 Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Sun, 9 Jul 2023 22:30:59 +0200
Subject: [PATCH 2/3] shared xxhash

---
 CMakeLists.txt                                  | 3 ++-
 Source/Core/VideoBackends/Vulkan/CMakeLists.txt | 2 +-
 Source/Core/VideoCommon/CMakeLists.txt          | 2 +-
 3 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index d9822ca59d..8815e8f7fd 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -663,7 +663,8 @@ dolphin_find_optional_system_library(pugixml Externals/pugixml)
 
 dolphin_find_optional_system_library_pkgconfig(ENET libenet>=1.3.8 enet::enet Externals/enet)
 
-if(NOT XXHASH_FOUND)
+pkg_check_modules(xxhash REQUIRED IMPORTED_TARGET libxxhash)
+if(NOT xxhash_FOUND)
   message(STATUS "Using static xxhash from Externals")
   add_subdirectory(Externals/xxhash)
 endif()
diff --git a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
index ec9e1b51cb..359fc0f0bb 100644
--- a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
+++ b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
@@ -45,7 +45,7 @@ PUBLIC
 PRIVATE
   # Link against glslang, the other necessary libraries are referenced by the executable.
   glslang
-  xxhash
+  PkgConfig::xxhash
 )
 
 if (ANDROID AND _M_ARM_64)
diff --git a/Source/Core/VideoCommon/CMakeLists.txt b/Source/Core/VideoCommon/CMakeLists.txt
index ba3b67faba..3e0ae39e61 100644
--- a/Source/Core/VideoCommon/CMakeLists.txt
+++ b/Source/Core/VideoCommon/CMakeLists.txt
@@ -200,7 +200,7 @@ PUBLIC
 PRIVATE
   fmt::fmt
   spng::spng
-  xxhash
+  PkgConfig::xxhash
   imgui
   implot
   glslang
-- 
2.41.0

