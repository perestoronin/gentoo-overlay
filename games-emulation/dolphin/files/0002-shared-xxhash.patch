From 0aad62630594861e4a281a52a2cf03f7b460d5ce Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Sat, 25 Feb 2023 09:42:24 +0100
Subject: [PATCH] system xxhash

---
 CMakeLists.txt                                  | 3 ++-
 Source/Core/VideoBackends/Vulkan/CMakeLists.txt | 2 +-
 Source/Core/VideoCommon/CMakeLists.txt          | 2 +-
 3 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 2530c1a0ef..4595b6e4a9 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -742,7 +742,8 @@ else()
   add_subdirectory(Externals/enet)
 endif()
 
-if(NOT XXHASH_FOUND)
+pkg_check_modules(xxhash REQUIRED IMPORTED_TARGET libxxhash)
+if(NOT xxhash_FOUND)
   message(STATUS "Using static xxhash from Externals")
   add_subdirectory(Externals/xxhash)
 endif()
diff --git a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
index 7abf9a038b..abfe895884 100644
--- a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
+++ b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
@@ -45,7 +45,7 @@ PUBLIC
 PRIVATE
   # Link against glslang, the other necessary libraries are referenced by the executable.
   glslang
-  xxhash
+  PkgConfig::xxhash
 )
 
 # Only include the Vulkan headers when building the Vulkan backend
diff --git a/Source/Core/VideoCommon/CMakeLists.txt b/Source/Core/VideoCommon/CMakeLists.txt
index 2737d5a514..9183096a49 100644
--- a/Source/Core/VideoCommon/CMakeLists.txt
+++ b/Source/Core/VideoCommon/CMakeLists.txt
@@ -185,7 +185,7 @@ PUBLIC
 PRIVATE
   fmt::fmt
   ${spng_target}
-  xxhash
+  PkgConfig::xxhash
   imgui
   implot
   glslang
-- 
2.39.2

