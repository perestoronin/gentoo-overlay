From 4408e17215f55264fce11dcb23e702bfd515276d Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Sun, 18 Sep 2022 20:32:04 +0200
Subject: [PATCH 2/2] system glslang

---
 CMakeLists.txt                                  | 12 ++++++++++--
 Source/Core/VideoBackends/Vulkan/CMakeLists.txt |  4 +++-
 Source/Core/VideoCommon/CMakeLists.txt          |  4 +++-
 3 files changed, 16 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index eac99af420..5e40070ce3 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -693,8 +693,16 @@ else()
   add_subdirectory(Externals/fmt EXCLUDE_FROM_ALL)
 endif()
 add_subdirectory(Externals/imgui)
-add_subdirectory(Externals/glslang)
-add_subdirectory(Externals/spirv_cross)
+
+find_package(glslang REQUIRED CONFIG)
+if(glslang_FOUND)
+  message(STATUS "Using shared glslang ${glslang_VERSION}")
+endif()
+
+find_package(spirv_cross_core REQUIRED)
+find_package(spirv_cross_glsl REQUIRED)
+find_package(spirv_cross_hlsl REQUIRED)
+find_package(spirv_cross_cpp REQUIRED)
 
 if(ENABLE_VULKAN)
   add_definitions(-DHAS_VULKAN)
diff --git a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
index 826cd5e932..1bea95e127 100644
--- a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
+++ b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
@@ -44,7 +44,9 @@ PUBLIC
 
 PRIVATE
   # Link against glslang, the other necessary libraries are referenced by the executable.
-  glslang
+  glslang::glslang
+  glslang::SPIRV
+  glslang::glslang-default-resource-limits
   PkgConfig::xxhash
 )
 
diff --git a/Source/Core/VideoCommon/CMakeLists.txt b/Source/Core/VideoCommon/CMakeLists.txt
index 5da849ef9e..ebe6779020 100644
--- a/Source/Core/VideoCommon/CMakeLists.txt
+++ b/Source/Core/VideoCommon/CMakeLists.txt
@@ -167,7 +167,9 @@ PRIVATE
   spng
   PkgConfig::xxhash
   imgui
-  glslang
+  glslang::glslang
+  glslang::SPIRV
+  glslang::glslang-default-resource-limits
 )
 
 if(_M_X86)
-- 
2.37.3

