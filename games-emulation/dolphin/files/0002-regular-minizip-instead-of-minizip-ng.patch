From 4801827c62f1c5869b88f6d2026fca4a8e144558 Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Tue, 30 Aug 2022 17:20:24 +0200
Subject: [PATCH] regular minizip instead of minizip ng

---
 CMakeLists.txt                                     | 7 +++----
 Source/Core/Common/CMakeLists.txt                  | 2 +-
 Source/Core/Common/MinizipUtil.h                   | 3 ++-
 Source/Core/Core/CMakeLists.txt                    | 3 ++-
 Source/Core/DiscIO/CMakeLists.txt                  | 4 ++--
 Source/Core/DiscIO/VolumeVerifier.cpp              | 3 ++-
 Source/Core/UICommon/CMakeLists.txt                | 2 +-
 Source/Core/UICommon/ResourcePack/ResourcePack.cpp | 4 ++--
 8 files changed, 15 insertions(+), 13 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 163ea2c943..8540b90db0 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -787,10 +787,9 @@ else()
   add_subdirectory(Externals/zstd)
 endif()
 
-add_subdirectory(Externals/zlib-ng)
-
-pkg_check_modules(MINIZIP minizip-ng>=3.0.0)
-if(MINIZIP_FOUND)
+pkg_check_modules(minizip REQUIRED IMPORTED_TARGET minizip)
+pkg_check_modules(zlib REQUIRED IMPORTED_TARGET zlib)
+if(minizip_FOUND)
   message(STATUS "Using shared minizip")
   include_directories(${MINIZIP_INCLUDE_DIRS})
 else()
diff --git a/Source/Core/Common/CMakeLists.txt b/Source/Core/Common/CMakeLists.txt
index 134d38062c..826dbd0892 100644
--- a/Source/Core/Common/CMakeLists.txt
+++ b/Source/Core/Common/CMakeLists.txt
@@ -157,7 +157,7 @@ PUBLIC
   enet
   fmt::fmt
   ${MBEDTLS_LIBRARIES}
-  minizip-ng
+  PkgConfig::minizip
 
 PRIVATE
   ${CURL_LIBRARIES}
diff --git a/Source/Core/Common/MinizipUtil.h b/Source/Core/Common/MinizipUtil.h
index 29b365c028..32772cfdc5 100644
--- a/Source/Core/Common/MinizipUtil.h
+++ b/Source/Core/Common/MinizipUtil.h
@@ -5,7 +5,8 @@
 
 #include <algorithm>
 
-#include <mz_compat.h>
+#include <minizip/zip.h>
+#include <minizip/unzip.h>
 
 #include "Common/CommonTypes.h"
 #include "Common/ScopeGuard.h"
diff --git a/Source/Core/Core/CMakeLists.txt b/Source/Core/Core/CMakeLists.txt
index 26787fcd3d..4dd6570b98 100644
--- a/Source/Core/Core/CMakeLists.txt
+++ b/Source/Core/Core/CMakeLists.txt
@@ -595,7 +595,8 @@ PUBLIC
 PRIVATE
   fmt::fmt
   ${LZO}
-  ZLIB::ZLIB
+  PkgConfig::minizip
+  PkgConfig::zlib
 )
 
 if ((DEFINED CMAKE_ANDROID_ARCH_ABI AND CMAKE_ANDROID_ARCH_ABI MATCHES "x86|x86_64") OR
diff --git a/Source/Core/DiscIO/CMakeLists.txt b/Source/Core/DiscIO/CMakeLists.txt
index 61790d89d8..dc420f9d6d 100644
--- a/Source/Core/DiscIO/CMakeLists.txt
+++ b/Source/Core/DiscIO/CMakeLists.txt
@@ -75,9 +75,9 @@ PUBLIC
 
 PRIVATE
   fmt::fmt
-  minizip-ng
   pugixml
-  ZLIB::ZLIB
+  PkgConfig::minizip
+  PkgConfig::zlib
 )
 
 if(MSVC)
diff --git a/Source/Core/DiscIO/VolumeVerifier.cpp b/Source/Core/DiscIO/VolumeVerifier.cpp
index 109b4c2f64..460c065f86 100644
--- a/Source/Core/DiscIO/VolumeVerifier.cpp
+++ b/Source/Core/DiscIO/VolumeVerifier.cpp
@@ -13,7 +13,8 @@
 #include <unordered_set>
 
 #include <mbedtls/md5.h>
-#include <mz_compat.h>
+#include <minizip/zip.h>
+#include <minizip/unzip.h>
 #include <pugixml.hpp>
 
 #include "Common/Align.h"
diff --git a/Source/Core/UICommon/CMakeLists.txt b/Source/Core/UICommon/CMakeLists.txt
index f2ffbd0821..fd3a8af9ff 100644
--- a/Source/Core/UICommon/CMakeLists.txt
+++ b/Source/Core/UICommon/CMakeLists.txt
@@ -31,7 +31,7 @@ target_link_libraries(uicommon
 PUBLIC
   common
   cpp-optparse
-  minizip-ng
+  PkgConfig::minizip
   pugixml
 
 PRIVATE
diff --git a/Source/Core/UICommon/ResourcePack/ResourcePack.cpp b/Source/Core/UICommon/ResourcePack/ResourcePack.cpp
index 355dc8acf2..f6ef61236a 100644
--- a/Source/Core/UICommon/ResourcePack/ResourcePack.cpp
+++ b/Source/Core/UICommon/ResourcePack/ResourcePack.cpp
@@ -6,8 +6,8 @@
 #include <algorithm>
 #include <memory>
 
-#include <mz_compat.h>
-#include <mz_os.h>
+#include <minizip/zip.h>
+#include <minizip/unzip.h>
 
 #include "Common/CommonPaths.h"
 #include "Common/FileSearch.h"
-- 
2.37.2

